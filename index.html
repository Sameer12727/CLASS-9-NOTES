<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notes Hub</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#0d0d0d;color:#ffd700;transition:0.35s ease;overflow-x:hidden;}
header{padding:25px;text-align:center;background:#000;color:#ffd700;position:sticky;top:0;z-index:100;box-shadow:0 4px 15px rgba(255,215,0,0.2);}
header h1{font-size:2.2rem;text-shadow:0 0 10px #ffd700;letter-spacing:1px;}
.theme-toggle{position:absolute;top:20px;right:20px;background:#111;border:2px solid #ffd700;color:#ffd700;width:55px;height:55px;border-radius:50%;cursor:pointer;font-size:24px;display:flex;align-items:center;justify-content:center;transition:0.4s ease;box-shadow:0 0 12px rgba(255,215,0,0.6);}
.theme-toggle:hover{transform: scale(1.15);box-shadow:0 0 20px rgba(255,215,0,1);}
.theme-toggle .sun,.theme-toggle .moon{position:absolute;transition:0.5s ease;}
body .sun{opacity:1;transform:scale(1) rotate(0deg);}
body .moon{opacity:0;transform:scale(0) rotate(-180deg);}
body.light{background:#f2f2f2;color:#000;}
body.light header{background:#fff;color:#000;}
body.light .theme-toggle{background:#fff;border-color:#000;color:#000;}
body.light .sun{opacity:0;transform:scale(0) rotate(180deg);}
body.light .moon{opacity:1;transform:scale(1) rotate(0deg);}
.container{padding:30px;max-width:1200px;margin:auto;}
.search-bar input{width:100%;padding:14px;margin-bottom:30px;border-radius:30px;border:none;background:#222;outline:none;color:#ffd700;font-size:1rem;box-shadow:0 0 10px rgba(255,215,0,0.3);}
.search-bar input::placeholder{color:#ffd700aa;}
.subjects{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:25px;}
.subject-card{background:#111;border-radius:25px;padding:30px;text-align:center;cursor:pointer;box-shadow:0 8px 20px rgba(255,215,0,0.2);transition:0.6s ease;transform:translateY(40px);opacity:0;}
.subject-card:hover{transform:translateY(-5px) scale(1.08);box-shadow:0 15px 30px rgba(255,215,0,0.5);}
.subject-card h3{color:#ffd700;font-size:1.4rem;margin-bottom:12px;text-shadow:0 0 6px #ffd700;}
.chapters{margin-top:18px;display:none;flex-direction:column;}
.chapter{padding:14px;background:#222;margin:8px 0;border-radius:12px;cursor:pointer;transition:0.4s;opacity:0;transform:translateX(-30px);color:#ffd700;text-shadow:0 0 4px #ffd700;display:flex;justify-content:space-between;align-items:center;}
.chapter:hover{background:#333;transform:scale(1.03);box-shadow:0 0 12px #ffd700;}
.notes-viewer{margin-top:35px;padding:25px;border:1px solid #444;border-radius:20px;min-height:500px;box-shadow:0 8px 25px rgba(255,215,0,0.2);}
iframe{width:100%;height:500px;border:none;border-radius:15px;}
.sidebar{position:fixed;top:0;left:-400px;width:350px;height:100%;background:#111;box-shadow:5px 0 25px rgba(255,215,0,0.3);transition:0.4s ease;z-index:200;display:flex;flex-direction:column;overflow-y:auto;padding:20px;}
.sidebar.open{left:0;}
.sidebar h2{color:#ffd700;margin-bottom:20px;text-align:center;}
.sidebar input,.sidebar button,.sidebar select{margin-bottom:15px;padding:10px;border-radius:10px;border:none;}
.sidebar input,.sidebar select{width:100%;}
.sidebar button{background:#ffd700;color:#000;font-weight:bold;cursor:pointer;transition:0.3s;}
.sidebar button:hover{background:#e6c200;}
.sidebar h3{margin-top:15px;color:#ffd700;}
.sidebar-toggle{position:fixed;top:25px;left:25px;width:45px;height:35px;cursor:pointer;z-index:210;display:flex;flex-direction:column;justify-content:space-between;}
.sidebar-toggle div{height:5px;background:#ffd700;border-radius:5px;transition:0.4s;}
.contact-admin{position:fixed;bottom:20px;right:20px;background:#ffd700;color:#000;padding:12px 20px;border-radius:50px;box-shadow:0 5px 15px rgba(255,215,0,0.5);font-weight:bold;cursor:pointer;transition:0.3s;text-decoration:none;}
.contact-admin:hover{background:#e6c200;}
body.light .sidebar{background:#fff;color:#000;}
body.light .sidebar input,body.light .sidebar button,body.light .sidebar select{color:#000;}
@media(max-width:600px){.subject-card{padding:20px;}.chapter{padding:12px;}.contact-admin{padding:10px 16px;bottom:15px;right:15px;}.sidebar{width:90%;}}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

</head>
<body>

<header>
  <h1>Notes Hub</h1>
  <button id="themeToggle" class="theme-toggle"><span class="sun">‚òÄÔ∏è</span><span class="moon">üåô</span></button>
</header>

<div class="sidebar" id="sidebar">
  <h2>Menu</h2>
  <button id="requestBtn">Request Any Notes</button>
  <div id="adminAccessDiv">
    <input type="password" id="adminKey" placeholder="Admin Key">
    <button id="adminLoginBtn">Admin Access</button>
    <div id="adminPanel" style="display:none;">
      <h3>Add Book</h3>
      <input type="text" id="newBookName" placeholder="Book Name">
      <button id="addBookBtn">Add Book</button>
      <h3>Add Chapter</h3>
      <select id="selectBook"></select>
      <input type="text" id="chapterName" placeholder="Chapter Name">
      <input type="text" id="chapterLink" placeholder="Notes Link (Drive)">
      <button id="addChapterBtn">Add Chapter</button>
      <h3>Existing Chapters</h3>
      <div id="chapterList"></div>
    </div>
  </div>
</div>

<div class="sidebar-toggle" id="sidebarToggle"><div></div><div></div><div></div></div>

<div class="container">
  <div class="search-bar"><input type="text" id="searchInput" placeholder="Search chapters..."></div>
  <div class="subjects" id="subjectsContainer"></div>
  <div class="notes-viewer" id="notesViewer"><p>Select a chapter to view notes here.</p></div>
</div>

<a href="https://www.tiktok.com/@sameer11284" target="_blank" class="contact-admin">Contact Admin</a>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBP4OzYeTgOY5cKxgHWQbYOJoOPkrs0_D0",
  authDomain: "sams-chat-415ce.firebaseapp.com",
  databaseURL: "https://sams-chat-415ce-default-rtdb.firebaseio.com",
  projectId: "sams-chat-415ce",
  storageBucket: "sams-chat-415ce.firebasestorage.app",
  messagingSenderId: "583183970312",
  appId: "1:583183970312:web:d5a8278dddf5e12da0a1bd"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let subjectsData=[]; let subjectsDataCache={};
const subjectsContainer=document.getElementById('subjectsContainer');
const notesViewer=document.getElementById('notesViewer');

// ===== FIREBASE LISTENER =====
db.ref('subjects').on('value',snapshot=>{
  subjectsDataCache = snapshot.val() || {};
  subjectsData = [];
  Object.keys(subjectsDataCache).forEach(bookKey=>{
    const book = subjectsDataCache[bookKey];
    const chapters = [];
    if(book.chapters){Object.keys(book.chapters).forEach(chKey=>{chapters.push({key:chKey,...book.chapters[chKey]});});}
    subjectsData.push({key:bookKey,name:book.name,chapters:chapters});
  });
  buildSubjects(); updateSelectBook(); displayChapters();
});

// ===== BUILD SUBJECTS =====
function buildSubjects(){
  subjectsContainer.innerHTML='';
  subjectsData.forEach((sub,i)=>{
    const card=document.createElement('div');card.className='subject-card';
    card.innerHTML=`<h3>${sub.name}</h3>`;
    const chaptersDiv=document.createElement('div');chaptersDiv.className='chapters';
    sub.chapters.forEach((ch,j)=>{
      const chDiv=document.createElement('div');chDiv.className='chapter';
      const span=document.createElement('span'); span.textContent=ch.name;
      chDiv.appendChild(span);
      chDiv.onclick=()=>{notesViewer.innerHTML=ch.link?`<iframe src="${ch.link}"></iframe>`:`<div style="color:#ffd700;font-size:1.2rem;text-align:center;margin-top:50px;">üöß COMING SOON!<br>Contact admin.</div>`;};
      chaptersDiv.appendChild(chDiv);
      setTimeout(()=>{chDiv.style.opacity='1';chDiv.style.transform='translateX(0)';},j*120);
    });
    card.appendChild(chaptersDiv);
    card.onclick=()=>{const visible=chaptersDiv.style.display==='flex';document.querySelectorAll('.chapters').forEach(c=>c.style.display='none');chaptersDiv.style.display=visible?'none':'flex';};
    subjectsContainer.appendChild(card);
    setTimeout(()=>{card.style.opacity='1';card.style.transform='translateY(0)';},i*150);
  });
}

// ===== SEARCH =====
document.getElementById('searchInput').addEventListener('input',e=>{
  const term=e.target.value.toLowerCase();
  subjectsContainer.querySelectorAll('.subject-card').forEach(card=>{
    const chapters=Array.from(card.querySelectorAll('.chapter span')).map(c=>c.textContent.toLowerCase()).join(' ');
    card.style.display=chapters.includes(term)?'grid':'none';
  });
});

// ===== THEME =====
const toggleBtn=document.getElementById("themeToggle");
toggleBtn.onclick=()=>{document.body.classList.toggle("light");localStorage.setItem("theme",document.body.classList.contains("light")?"light":"dark");};
if(localStorage.getItem("theme")==="light"){document.body.classList.add("light");}

// ===== SIDEBAR =====
const sidebar=document.getElementById('sidebar');
document.getElementById('sidebarToggle').onclick=()=>{sidebar.classList.toggle('open');};
document.getElementById('requestBtn').onclick=()=>{window.open("mailto:sameergamer442@gmail.com?subject=Request%20Any%20Notes");}

// ===== ADMIN =====
const adminKeyInput=document.getElementById('adminKey');
const adminLoginBtn=document.getElementById('adminLoginBtn');
const adminPanel=document.getElementById('adminPanel');
const selectBook=document.getElementById('selectBook');
const chapterList=document.getElementById('chapterList');

adminLoginBtn.onclick=()=>{if(adminKeyInput.value==='1128'){adminPanel.style.display='block';updateSelectBook();displayChapters();}else{alert('Invalid Admin Key');}};

document.getElementById('addBookBtn').onclick=()=>{
  const name=document.getElementById('newBookName').value.trim();
  if(name){db.ref('subjects').push({name:name});document.getElementById('newBookName').value='';}
};

document.getElementById('addChapterBtn').onclick=()=>{
  const bookIndex=selectBook.value;
  const chName=document.getElementById('chapterName').value.trim();
  const chLink=document.getElementById('chapterLink').value.trim();
  if(chName && subjectsData[bookIndex]){
    const bookId=subjectsData[bookIndex].key;
    db.ref(`subjects/${bookId}/chapters`).push({name:chName,link:chLink});
    document.getElementById('chapterName').value='';
    document.getElementById('chapterLink').value='';
  }
};

// ===== UPDATE SELECT BOOK =====
function updateSelectBook(){
  selectBook.innerHTML='';
  subjectsData.forEach((b,i)=>{selectBook.innerHTML+=`<option value="${i}">${b.name}</option>`;});
}

// ===== DISPLAY ADMIN CHAPTERS =====
function displayChapters(){
  chapterList.innerHTML='';
  subjectsData.forEach((b,bi)=>{
    b.chapters.forEach((ch,ci)=>{
      const div=document.createElement('div');div.style.marginBottom='8px';
      div.innerHTML=`${b.name} - ${ch.name} 
        <button style="margin-left:5px;" onclick="editChapter('${b.key}','${ch.key}')">Edit</button>
        <button style="margin-left:5px;" onclick="deleteChapter('${b.key}','${ch.key}')">Delete</button>`;
      chapterList.appendChild(div);
    });
  });
}

// ===== EDIT / DELETE =====
function editChapter(bookKey,chKey){
  const chRef=db.ref(`subjects/${bookKey}/chapters/${chKey}`);
  chRef.once('value').then(snap=>{
    const ch=snap.val();
    const newName=prompt("Chapter Name:",ch.name);
    const newLink=prompt("Notes Link:",ch.link);
    if(newName!==null && newLink!==null){chRef.set({name:newName,link:newLink});}
  });
}

function deleteChapter(bookKey,chKey){
  if(confirm("Delete this chapter?")){db.ref(`subjects/${bookKey}/chapters/${chKey}`).remove();}
}

</script>
</body>
</html>